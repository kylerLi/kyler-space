<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
<link href="../../../static/js/common/libs/markdown/editor.md/css/editormd.min.css" 
    th:href="@{/js/common/libs/markdown/editor.md/css/editormd.min.css}" rel="stylesheet" media="screen" />
<link href="../../../static/js/common/libs/tagsinput/bootstrap-tagsinput.css" 
    th:href="@{/js/common/libs/tagsinput/bootstrap-tagsinput.css}" rel="stylesheet" media="screen" />
<link href="../../../static/js/common/libs/tagsinput/app.css" 
    th:href="@{/js/common/libs/tagsinput/app.css}" rel="stylesheet" media="screen" />
<link href="../../static/css/font-awesome.min.css"
	th:href="@{/css/font-awesome.min.css}" rel="stylesheet" media="screen" />
<link href="../../static/css/ionicons.min.css"
	th:href="@{/css/ionicons.min.css}" rel="stylesheet" media="screen" />
<link href="../../static/css/style.css" th:href="@{/css/style.css}"
	rel="stylesheet" media="screen" />
<link href="../../static/css/bootstrap.min.css"
	th:href="@{/css/bootstrap.min.css}" rel="stylesheet" media="screen" />

<!-- <link href="http://cdn.jsdelivr.net/webjars/bootstrap/3.3.4/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/3.3.4/css}"/> -->
<script src="http://cdn.jsdelivr.net/webjars/jquery/2.1.4/jquery.min.js"
	th:src="@{/webjars/jquery/2.1.4/jquery.min.js}"></script>
<script
	src="http://cdn.jsdelivr.net/webjars/bootstrap/3.3.4/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/3.3.4/js/bootstrap.min.js}"></script>
<script src="../../static/js/jquery-ui-1.10.3.min.js"
	th:src="@{js/jquery-ui-1.10.3.min.js}" type="text/javascript"></script>
	
</head>
<body>

    <div class="row">
		<div class="col-md-12">
			<!--breadcrumbs start -->
			<ul class="breadcrumb" style="background-color:#fff">
				<li><a href="#"><i class="fa fa-home"></i> Home</a></li>
				<li><a href="#">Dashboard</a></li>
				<li class="active">Current page</li>
			</ul>
		</div>
	</div>

    <div class="row">
        <div class="col-sm-12">
            <div class="box box-primary">
                <div class="box-header bg-info" style="padding-bottom: 0">
                    <div class="row" style="padding-bottom:5px;">
                        <div class="col-sm-7">
                            <div clas="form-group">
                              <input class="form-control" type="text" id="title" placeholder="请输入文章标题……"/>
                            </div>
                        </div>
                        <div class="col-sm-5">
                            <div clas="form-group">
                                <input  type="text" id="keywords" data-role="tagsinput" placeholder="关键字" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                       <div class="form-group col-sm-7">
                        <div class="col-sm-4">
                            <select id="editormd-theme-select" class="form-control select2">
                                <option selected="selected" value="">工具栏样式</option>
                            </select>
                        </div>
                        <div class="col-sm-4">
                            <select id="editor-area-theme-select" class="form-control select2">
                                <option selected="selected" value="">编辑区样式</option>
                            </select>
                        </div>
                        <div class="col-sm-4">
                            <select id="preview-area-theme-select" class="form-control select2">
                                <option selected="selected" value="">预览区样式</option>
                            </select>
                        </div>
                    </div>
                       <div class="form-group col-sm-5 pull-right">
                        <div class="col-sm-6">
                            <label class="control-label">
                                <input type="checkbox" name="autoHeight" data-flag="icheck" class="square-green"
                                       id="autoHeight"/> 自适应高度
                            </label>
                            <input type="hidden" name="code" id="code"/>
                        </div>
                        <div class="col-sm-6 text-right">
                            <div class="btn-group ">
                                <button class="btn btn-default"  id="backMD"><i class="fa fa-reply">&nbsp;&nbsp;返回</i></button>
                                <button class="btn btn-primary"  id="submitMD"><i class="fa fa-save">&nbsp;&nbsp;保存</i></button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div clas="box-body">
                    <div id="editormd">
                        <textarea style="display:none;"></textarea>

                      <!--  <h1 th:inline="text">Hello [[${#request.ctx}]]!</h1> -->
                     <!--   <p th:text="${#servletContext.getAttribute('ctx')}" th:unless="${request == null}">[...]</p> -->
                      <p th:text="${request.ctx}" th:unless="${request == null}">[...]</p>
                       aa
                    </div>
                </div>
            </div>
        </div>
    </div>

<script type="text/javascript" src="../../../static/js/common/libs/markdown/editor.md/js/editormd.min.js" th:src="@{js/common/libs/markdown/editor.md/js/editormd.min.js}"></script>
<script type="text/javascript" src="../../../static/js/common/libs/tagsinput/bootstrap-tagsinput.min.js" th:src="@{js/common/libs/tagsinput/bootstrap-tagsinput.min.js}"></script>
<script type="text/javascript">
var editor;

$(function () {
    //---初始化控件-----
    //高度自定义框


    //-----数据回填-------------
    var mid="${id?default('')}";
    console.log(mid)
var ctx = ${request.ctx}
console.log(ctx)
    function fillLocalStorage(result){
        localStorage.mdtitle=result.title;
        localStorage.mdkeywords=result.keywords;
        localStorage.markdownContent=result.content;
    }
    //文章标题
    $("#title").on("change",function(event){
        var $title=$(event.target);
        localStorage.mdtitle=$title.val();
    })

    //keywords 关键字
    $("#keywords").on("change",function(event){
         var $element=$(event.target);
         var val = $element.val();
         //修复placeholder问题
         if(val){
             $element.prev(".bootstrap-tagsinput").find("input:eq(0)").attr("placeholder",null);
         }else{
             $element.prev(".bootstrap-tagsinput").find("input:eq(0)").attr("placeholder","关键字");
         }
        localStorage.mdkeywords=val;
    });
    if(localStorage.mdkeywords){
        //alert(localStorage.mdkeywords);
        $("#keywords").tagsinput("add",localStorage.mdkeywords);
    }

    //markdown 默认内容
    var markdownContent = null;

    $.ajax({
        type: "get",
        url: ctx + "/static/js/common/libs/markdown/readme.md",
        async: false,
        success: function (md) {
           // markdownContent = localStorage.markdownContent ? localStorage.markdownContent : md;
        }
    });

    editor = editormd("editormd", {
        width: "100%",
        height: "80%",
        theme:  "default",
        previewTheme:  "default",
        editorTheme:  "default",
        path: ctx + '/static/js/common/libs/markdown/editor.md/lib/',
        autoHeight: isAutoHeight == "true" ? true : false,

        codeFold : true,
        searchReplace : true,
        saveHTMLToTextarea : true,

        htmlDecode: "style,script,iframe",
        tex: true,
        emoji: true,
        taskList: true,
        flowChart: true,
        sequenceDiagram: true,
        markdown: "xxxx",
        syncScrolling:true,

        //图片上传
        imageUpload: true,
        imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
        imageUploadURL: "${ctx}/file/markdownUpload",
        onchange: function () {
            //localStorage.markdownContent = editor.getMarkdown();
        }
    });


    /* themeSelect("editormd-theme-select", editormd.themes, "theme", function ($this, theme) {
        editor.setTheme(theme);
    });

    themeSelect("editor-area-theme-select", editormd.editorThemes, "editorTheme", function ($this, theme) {
        editor.setCodeMirrorTheme(theme);
    });

    themeSelect("preview-area-theme-select", editormd.previewThemes, "previewTheme", function ($this, theme) {
        editor.setPreviewTheme(theme);
    }); */

    //导出pdf
    /* $("#submitMD").click(function(){
        var obj_md={};
        obj_md["content"]=editor.getMarkdown();
        obj_md["keywords"]=$("#keywords").val();
        obj_md["title"]=$("#title").val();
        obj_md["id"]="${id?default('')}";
        ajaxPost(ctx+"/markdown/save",obj_md,function(result){
            if(result.success){
                modals.info("保存成功");
                returnToList();
            }
        })
    }); */

});

</script>
</body></html>
