<html xmlns:th="http://www.thymeleaf.org">
<header th:replace="markdown/resources::resources-md">
</header>
<body th:fragment="markdown_edit" >
<div class="row" style="height:20px"></div>
    <div class="row">
		<div class="col-md-12">
			<!--breadcrumbs start -->
			<ul class="breadcrumb" style="background-color:#fff">
				<li><a href="#"><i class="fa fa-home"></i> 系统管理</a></li>
				<li><a href="#">写博客</a></li>
				<li class="active">当前页</li>
			</ul>
		</div>
	</div>

    <div class="row">
        <div class="col-sm-12">
            <div class="box box-primary">
                <div class="box-header bg-info" style="padding-bottom: 0">
                    <div class="row" style="padding-bottom:5px;">
                        <div class="col-sm-7">
                            <div clas="form-group">
                              <input class="form-control" type="text" id="title" placeholder="请输入文章标题……"/>
                            </div>
                        </div>
                        <div class="col-sm-5">
                            <div clas="form-group">
                                <input  type="text" id="keywords" data-role="tagsinput" placeholder="关键字" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                       <div class="form-group col-sm-7">
                        <div class="col-sm-4">
                            <select id="editormd-theme-select" class="form-control select2">
                                <option selected="selected" value="">工具栏样式</option>
                            </select>
                        </div>
                        <div class="col-sm-4">
                            <select id="editor-area-theme-select" class="form-control select2">
                                <option selected="selected" value="">编辑区样式</option>
                            </select>
                        </div>
                        <div class="col-sm-4">
                            <select id="preview-area-theme-select" class="form-control select2">
                                <option selected="selected" value="">预览区样式</option>
                            </select>
                        </div>
                    </div>
                       <div class="form-group col-sm-5 pull-right">
                        <div class="col-sm-6">
                            <label class="control-label">
                                <input type="checkbox" name="autoHeight" data-flag="icheck" class="square-green"
                                       id="autoHeight"/> 自适应高度
                            </label>
                            <input type="hidden" name="code" id="code"/>
                        </div>
                        <div class="col-sm-6 text-right">
                            <div class="btn-group ">
                                <button class="btn btn-default"  id="backMD"><i class="fa fa-reply">&nbsp;&nbsp;返回</i></button>
                                <button class="btn btn-primary"  id="submitMD"><i class="fa fa-save">&nbsp;&nbsp;保存</i></button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div clas="box-body">
                    <div id="editormd">
                        <textarea style="display:none;"></textarea>

                    </div>
                </div>
            </div>
        </div>
    </div>
<script src="../../static/js/common/libs/markdown/editor.md/js/editormd.min.js" th:src="@{js/common/libs/markdown/editor.md/js/editormd.min.js}" type="text/javascript"></script>
<script src="../../static/js/common/libs/tagsinput/bootstrap-tagsinput.min.js" th:src="@{js/common/libs/tagsinput/bootstrap-tagsinput.min.js}" type="text/javascript"></script>

<script type="text/javascript">
var editor;

$(function () {
    //---初始化控件-----

    //-----数据回填-------------


    //文章标题
    $("#title").on("change",function(event){
        var $title=$(event.target);
    })

    //keywords 关键字
    $("#keywords").on("change",function(event){
         var $element=$(event.target);
         var val = $element.val();
         //修复placeholder问题
         if(val){
             $element.prev(".bootstrap-tagsinput").find("input:eq(0)").attr("placeholder",null);
         }else{
             $element.prev(".bootstrap-tagsinput").find("input:eq(0)").attr("placeholder","关键字");
         }
    });

    //markdown 默认内容
    var markdownContent = null;

    editor = editormd("editormd", {

        path: '/static/js/common/libs/markdown/editor.md/lib',
        autoHeight:false,

        codeFold : true,
        searchReplace : true,
        saveHTMLToTextarea : true,

        htmlDecode: "style,script,iframe",
        tex: true,
        emoji: true,
        taskList: true,
        flowChart: true,
        sequenceDiagram: true,
        markdown: "本Markdown编辑器使用**Editor.md**修改而来，用它写技术文章，将会带来全新的体验哦：- **Markdown和扩展Markdown简洁的语法**",
        syncScrolling:true,

        //图片上传
        imageUpload: true,
        imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
        imageUploadURL: "${basePath}/file/markdownUpload",
        onchange: function () {
        }
    });


    //导出pdf
    $("#submitMD").click(function(){
        var obj_md={};
        obj_md["content"]=editor.getMarkdown();
        obj_md["keywords"]=$("#keywords").val();
        obj_md["title"]=$("#title").val();
        obj_md["id"]="${id?default('')}";
        ajaxPost(basePath+"/markdown/save",obj_md,function(result){
            if(result.success){
                modals.info("保存成功");
                returnToList();
            }
        })
    });

    $("#backMD").click(function () {
        returnToList();
    });
});




function returnToList(){
    loadPage(basePath+"/markdown/list");
}



</script>
</body></html>
